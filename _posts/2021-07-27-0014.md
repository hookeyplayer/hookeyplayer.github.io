---
layout: post
title: 一氧化碳回归
date: 2021-07-27 19:28:58
category: statistics
---
## 0.项目地址
[project](http://www.statsci.org/data/general/cofreewy.html)

## 1.数据读取和初步回归
<pre><code>
library(readr)
cofreewy <- read_table2("http://www.statsci.org/data/general/cofreewy.txt")
a <- lm(CO~., data=cofreewy)
summary(a)
</code></pre>
![全部自变量做线性回归](https://github.com/hookeyplayer/hookeyplayer.github.io/blob/master/_pics/Screenshot%202021-07-27%20at%2021.57.24.png)

逐步回归和全部自变量的回归相比，舍弃了Hour变量。
<pre><code>
b <- step(a, direction='backward') 
summary(b)
</code></pre>
![逐步回归](https://github.com/hookeyplayer/hookeyplayer.github.io/blob/master/_pics/Screenshot%202021-07-27%20at%2021.57.30.png)

残差的Shapiro-Wilk正态性检验的p值为0.05601，严格说0.05的显著性水平下不能拒绝“残差来自正态总体”的假设（数据量小，往往不容易拒绝零假设），并且看逐步回归（b）的残差图也无法判断是正态分布的。
![残差的Shapiro-Wilk正态检验](https://github.com/hookeyplayer/hookeyplayer.github.io/blob/master/_pics/Screenshot%202021-07-27%20at%2022.11.49.png)
<pre><code>
b <- step(a, direction='backward') 
qqnorm(b$residuals)
qqline(b$residuals)
</code></pre>

![简单回归残差的QQ图](https://github.com/hookeyplayer/hookeyplayer.github.io/blob/master/_pics/Screenshot%202021-07-27%20at%2022.27.08.png)

从散点图看出CO和Hour有正弦曲线的关系，周期性可以借助时间序列分析的谐波分析，用有穷Fourier级数代表时间序列,可以考察各变量二次项和三次项对CO的影响。
<pre><code>
plot(cofreewy) # 或：pairs(cofreewy)
</code></pre>
![pairwise散点图绘制](https://github.com/hookeyplayer/hookeyplayer.github.io/blob/master/_pics/Screenshot%202021-07-27%20at%2022.31.45.png)

## 2.第二次回归
<pre><code>
attach(cofreewy)
cor(cbind(CO, 
          Traffic, Tsq=Traffic^2, Tcub=Traffic^3,
          Wind, Wsq=Wind^2, Wcub=Wind^3,
          Hour, Hsq=Hour^2, Hcub=Hour^3))
c <- lm(CO~Traffic+Wind+I(Wind^2)+I(Wind^3)+
          sin((2*pi/24)*Hour)+cos((2*pi/24)*Hour)+
          sin((4*pi/24)*Hour)+cos((4*pi/24)*Hour))
d <- step(c)
summary(d)
</code></pre>
![Correlation](https://github.com/hookeyplayer/hookeyplayer.github.io/blob/master/_pics/Screenshot%202021-07-30%20at%2002.58.42.png)

![Fourier级数代表时间序列（不会）](https://github.com/hookeyplayer/hookeyplayer.github.io/blob/master/_pics/Screenshot%202021-07-30%20at%2002.47.13.png)

<pre><code>
anova(d)
</code></pre>
![方差分析](https://github.com/hookeyplayer/hookeyplayer.github.io/blob/master/_pics/Screenshot%202021-07-30%20at%2002.47.30.png)

<pre><code>
shapiro.test(d$residuals)
</code></pre>
![正态分析](https://github.com/hookeyplayer/hookeyplayer.github.io/blob/master/_pics/Screenshot%202021-07-30%20at%2002.50.27.png)

上述结果的Wind三次项和sin项不理想，所以修改模型。

## 3.第三次回归
<pre><code>
attach(cofreewy)
c1 <- lm(CO~Traffic+Wind+I(Wind^2)+
          cos((2*pi/24)*Hour)+
          cos((4*pi/24)*Hour))
d1 <- step(c1)
summary(d1)
anova(d1)
qqnorm(d1$residuals)
qqline(d1$residuals)
</code></pre>

![相关结果](https://github.com/hookeyplayer/hookeyplayer.github.io/blob/master/_pics/Screenshot%202021-07-30%20at%2003.05.45.png)

![修正后回归的残差QQ图](https://github.com/hookeyplayer/hookeyplayer.github.io/blob/master/_pics/Screenshot%202021-07-30%20at%2003.06.47.png)
